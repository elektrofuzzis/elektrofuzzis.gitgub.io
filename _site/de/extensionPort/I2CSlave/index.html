<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>I²C TX-/TXT-Kommunikation -</title>
<meta name="description" content="The ftSwarm Project connects multiple controllers in DIY roboticy projects.">


  <meta name="author" content="The ftSwarm Project">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="I²C TX-/TXT-Kommunikation">
<meta property="og:url" content="https://elektrofuzzis.github.io/de/extensionPort/I2CSlave/">


  <meta property="og:description" content="The ftSwarm Project connects multiple controllers in DIY roboticy projects.">











  

  


<link rel="canonical" href="https://elektrofuzzis.github.io/de/extensionPort/I2CSlave/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "The ftSwarm Project",
      "url": "https://elektrofuzzis.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--category wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/img/ftSwarm.svg" alt=""></a>
        
          <a class="site-title" href="/">
          
          
        </a>

        <!-- original stuff 
        <ul class="visible-links"></ul>
        end original stuff-->

        <script>
          function callRef( url ) {
            if ( location.pathname.startsWith('/en/') ) {
              location.href='/en/'+url;
            } else {
              location.href='/de/'+url;
            }
          }
        </script>

        <ul class="visible-links">
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('gettingstarted/gettingstarted')" title="Manual">Manual</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('cpp-api/index')" title="api">api</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('products/index')" title="Products">Products</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('faq')" title="FAQ">FAQ</a>
          </li>
        </ul>


        <!-- language picker -->

        <a class="alang" href="#" onclick="location.href=location.href.replace('/de/', '/en/')"><img class="language-picker" src="/assets/img/uk.png"></a>
        <a class="alang" href="#" onclick="location.href=location.href.replace('/en/', '/de/')"><img class="language-picker" src="/assets/img/germany.png"></a>
        
        <!-- language picker -->

        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Manual</span>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Inbetriebnahme</span>
        

        
        <ul>
          
            <li><a href="/de/gettingstarted/pinout">Anschlüsse</a></li>
          
            <li><a href="/de/gettingstarted/serial">USB Anschluss</a></li>
          
            <li><a href="/de/gettingstarted/WebUI">WLAN & Statusseite</a></li>
          
            <li><a href="/de/gettingstarted/ide">Installation IDE</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Programmierung</span>
        

        
        <ul>
          
            <li><a href="/de/programming/MotorSwitch">Das erste Programm</a></li>
          
            <li><a href="/de/programming/kelda">Das Kelda Prinzip</a></li>
          
            <li><a href="/de/programming/MotorSwitchSwarm">Ein erster Schwarm</a></li>
          
            <li><a href="/de/programming/MotorSwitchAlias">Alias Namen</a></li>
          
            <li><a href="/de/programming/switches">Switches & Buttons</a></li>
          
            <li><a href="/de/programming/RemoteControl">Fernbedienung</a></li>
          
            <li><a href="/de/programming/EventControlled">Events</a></li>
          
            <li><a href="/de/programming/FtSwarmPixel">RGB LEDs & FtSwarmPixel</a></li>
          
            <li><a href="/de/programming/FtSwarmOLED">OLED Display</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/de/rs485/rs485"><span class="nav__sub-title">RS485</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Extension Port</span>
        

        
        <ul>
          
            <li><a href="/de/extensionPort/index">Einführung</a></li>
          
            <li><a href="/de/extensionPort/I2CMaster">I²C Breakout-Boards</a></li>
          
            <li><a href="/de/extensionPort/I2CSlave">I²C TX-/TXT Kommunikation</a></li>
          
            <li><a href="/de/extensionPort/gyro">Gyro</a></li>
          
            <li><a href="/de/extensionPort/outputs">Motorausgänge</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Firmware</span>
        

        
        <ul>
          
            <li><a href="/de/firmware/Configuration">Konfiguration</a></li>
          
            <li><a href="/de/firmware/firmware">Firmware & Updates</a></li>
          
            <li><a href="/de/firmware/versions">Versionen</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Advanced</span>
        

        
        <ul>
          
            <li><a href="/de/advanced/PlatformIO">PlatformIO & VSCode</a></li>
          
            <li><a href="/de/advanced/debugging">Debugging</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <div class="archive">
    
      <h1 id="page-title" class="page__title">I²C TX-/TXT-Kommunikation</h1>
    
    <p>Mit diesem Modus kann der Swarm mit einem fischertechnik TX- oder TXT-Controller verbunden werden. Dabei wird der fischertechnik-Controller nicht als Swarm-Member in den Swarm integriert; Ihr normales RoboPro-Programm kann aber über die I²C-Schnittstelle mit dem Swarm Daten austauschen.</p>

<p>Bei dieser Kopplung ist der ftSwarm ein I²C-Bus-Slave-Device und stellt bis zu acht 8-Bit-Register für den Datenaustausch bereit. Der TXT-Controller kann die Register aktiv auslesen oder in sie Werte schreiben. Alle Register können als Schreib- und Leseregister verwendet werden.</p>

<p>Sie legen selbst fest, welche Bedeutung/Funktion ein Register hat. Für die Firmware sind die Register nur ein Block aus 8 Bytes.</p>

<p>Jeder ftSwarm-, ftSwarmRS- oder ftSwarmXL-Controller im Swarm kann die Kommunikation mit dem TXT-Controller übernehmen.</p>

<p class="notice--info">Stellen Sie für diesen Betriebsmodus im <strong>Extension Menu</strong> der Firmware <strong>Mode</strong> auf <strong>I2C Master</strong>.</p>

<h3 id="anschluß-der-hardware">Anschluß der Hardware</h3>

<p>Die Verbindung der beiden I²C-Schnittstellen ist beim TXT-Controller sehr einfach und kann z.B. mit Jumperkabeln erfolgen:</p>

<div class="centershock"><img src="/assets/img/TXT-ftSwarm.svg" width="33%" /></div>

<p class="notice--info">Die Pins des Extension Ports sind nicht gegen Verpolung geschützt. Schaltfehler können sowohl Ihren ftSwarm-Controller als auch den TXT-Controller beschädigen.</p>

<p class="notice--info">Beachten Sie bitte, dass der TX-Controller 5V-Logiklevel verwendet und einen Pegelwandler wie den ftExtender benötigt.</p>

<h3 id="daten-vom-tx-txt-controller-an-den-swarm-senden">Daten vom TX-/TXT-Controller an den Swarm senden</h3>

<p>Soll der TXT Daten an den Swarm übertragen, so erfolgt dies über das RoboPro-Kommando <strong>I2C Write</strong>:</p>

<div class="centershock"><img src="/assets/img/i2c-write.png" width="400" /></div>

<p>In diesem Beispiel schreibt der TXT-Controller in das Register 3 den Wert 42. Die verwendete I²C-Adresse muss die des ftSwarm-Controllers sein. 0x66 ist die Defaultadresse des Controllers.</p>

<p>Der Wert wird im Swarm auf die Kelda übertragen und kann dort mit der Funktion <code class="language-plaintext highlighter-rouge">getRegister</code> ausgelesen werden:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FtSwarmI2C</span> <span class="o">*</span><span class="n">i2c</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FtSwarmI2C</span><span class="p">(</span> <span class="s">"I2C Alias"</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span> <span class="s">"Read I2C-Register #3: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i2c</span><span class="o">-&gt;</span><span class="n">getRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div></div>

<p>Bitte beachten Sie, dass die Registeränderungen durch den TXT im Swarm “nur” alle 25ms übertragen werden. Schreibt der TXT innerhalb von 25 ms unterschiedliche Werte in ein Register, so kann die Kelda nur den letzten Wert verarbeiten.</p>

<p class="notice--info">Die I²C-Adresse des ftSwarm-Controllers wird im <strong>Extension Port Menu</strong> mit der Option <strong>I2C Slave Address</strong> eingestellt. Die Anzahl der verfügbaren Register wird im gleichen Menü über die Option <strong>I2C Registers</strong> eingestellt.</p>

<h3 id="daten-vom-swarm-an-den-tx-txt-controller-senden">Daten vom Swarm an den TX-/TXT-Controller senden</h3>

<p>Das Senden von Daten vom Swarm an den TXT-Controller erfolgt über die Funktion <code class="language-plaintext highlighter-rouge">setRegister</code>. In diesem Beispiel wird der Wert 42 in Register 0 gesetzt.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FtSwarmI2C</span> <span class="o">*</span><span class="n">i2c</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FtSwarmI2C</span><span class="p">(</span> <span class="s">"I2C Alias"</span><span class="p">);</span>
<span class="n">i2c</span><span class="o">-&gt;</span><span class="n">setRegister</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
</code></pre></div></div>

<p>Mit dem RoboPro-Kommando “I2C Read” liest der TXT-Controller das Register aus:</p>

<div class="centershock"><img src="/assets/img/i2c-read.png" width="400" /></div>

<p>RoboPro muss immer alle zur Verfügung stehenden Register auslesen. Das Beispiel funktioniert so nur, wenn die Anzahl der I²C-Register in der Firmware auf 1 gesetzt wurde. Sollen z.B. 4 Register verwendet werden, so müssen in Robo-Pro immer alle 4 Register gelesen werden:</p>

<div class="centershock"><img src="/assets/img/i2c-multiple-read.png" width="250" /></div>

<p>Die ersten drei Lese-Kommandos benötigen die Option “offen lassen”, beim vierten Kommando wird diese Option nicht gesetzt.</p>

<h3 id="interruptmodus">Interruptmodus</h3>

<p>Für den TXT ist es häufig nur interessant die I²C-Register auszulesen, wenn diese auch verändert wurden. Dazu kann ein Pin eines Motorausgangs  mit einem Eingang des TXT verbunden werden. Schreibt der Swarm in das Register, wird der Motorausgang aktiviert. Der TXT sieht die Flanke und liest dann die Register aus. Mit dem Auslesen der Register wird der Motorausgang wieder deaktiviert.</p>

<div class="centershock"><img src="/assets/img/i2c-multiple-read-interrupt.png" width="250" /></div>

<p>In diesem Code-Beispiel werdenm die Register werden nur ausgelesen, wenn am  Eingang I1 einen Flankenwechsel stattfindet.</p>

<p>Der Motorausgang muss auf dem gleichen Swarm-Member liegen, auf dem auch die I²C-Verbindung geschaltet wurde. Es wird nur einer der beiden Anschlüsse am Motorausgang verbunden:</p>

<div class="centershock"><img src="/assets/img/TXT-ftSwarm-Int.svg" width="33%" /></div>

<p>In der Firmware des ftSwarm-Controllers wird die Option <strong>Interrupt Line</strong> auf den entsprechenden Motorausgang gesetzt.</p>

<p>Mit den beiden Menüpunkten <strong>Interrupt Low Value</strong> und <strong>Interrupt High Value</strong> können die Speed-Werte für den Motorausgang eingestellt werden. In der Regel sind dies -255 für <strong>Low</strong> und 255 für <strong>High</strong>. Je nachdem, welcher Anschluß am Motorausgang verwendet wurde, müssen Sie die beiden Werte evtl. vertauschen.</p>




<div class="entries-list">
  
</div>

  </div>
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/elektrofuzzis" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/elektrofuzzies" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="mailto:ftpi@gmx.de" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 The ftSwarm Project. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
