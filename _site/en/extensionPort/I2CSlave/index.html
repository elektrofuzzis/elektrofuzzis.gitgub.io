<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>I²C TX-/TXT-Communication -</title>
<meta name="description" content="The ftSwarm Project connects multiple controllers in DIY roboticy projects.">


  <meta name="author" content="The ftSwarm Project">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="I²C TX-/TXT-Communication">
<meta property="og:url" content="http://localhost:4000/en/extensionPort/I2CSlave/">


  <meta property="og:description" content="The ftSwarm Project connects multiple controllers in DIY roboticy projects.">











  

  


<link rel="canonical" href="http://localhost:4000/en/extensionPort/I2CSlave/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "The ftSwarm Project",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--category wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    
<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/img/ftSwarm.svg" alt=""></a>
        
          <a class="site-title" href="/">
          
          
        </a>

        <!-- original stuff 
        <ul class="visible-links"></ul>
        end original stuff-->

        <script>
          function callRef( url ) {
            if ( location.pathname.startsWith('/en/') ) {
              location.href='/en/'+url;
            } else {
              location.href='/de/'+url;
            }
          }
        </script>

        <ul class="visible-links">
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('gettingstarted/gettingstarted')" title="Manual">Manual</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('cpp-api/index')" title="api">api</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('products/index')" title="Products">Products</a>
          </li>
          <li class="masthead__menu-item">
            <a href="#" onclick="callRef('faq')" title="FAQ">FAQ</a>
          </li>
        </ul>


        <!-- language picker -->

        <a class="alang" href="#" onclick="location.href=location.href.replace('/de/', '/en/')"><img class="language-picker" src="/assets/img/uk.png"></a>
        <a class="alang" href="#" onclick="location.href=location.href.replace('/en/', '/de/')"><img class="language-picker" src="/assets/img/germany.png"></a>
        
        <!-- language picker -->

        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Manual</span>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Gettting started</span>
        

        
        <ul>
          
            <li><a href="/en/gettingstarted/pinout">Connectors</a></li>
          
            <li><a href="/en/gettingstarted/serial">USB/Serial Connection</a></li>
          
            <li><a href="/en/gettingstarted/WebUI">wifi & status page</a></li>
          
            <li><a href="/en/gettingstarted/ide">Install IDE</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Programming</span>
        

        
        <ul>
          
            <li><a href="/en/programming/MotorSwitch">My First Application</a></li>
          
            <li><a href="/en/programming/kelda">The Kelda Principle</a></li>
          
            <li><a href="/en/programming/MotorSwitchSwarm">A first Swarm</a></li>
          
            <li><a href="/en/programming/MotorSwitchAlias">Alias Names</a></li>
          
            <li><a href="/en/programming/switches">Switches & Buttons</a></li>
          
            <li><a href="/en/programming/RemoteControl">Remote Control</a></li>
          
            <li><a href="/en/programming/EventControlled">Events</a></li>
          
            <li><a href="/en/programming/FtSwarmPixel">RGB LEDs & FtSwarmPixel</a></li>
          
            <li><a href="/en/programming/FtSwarmOLED">OLED Display</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/en/rs485/rs485"><span class="nav__sub-title">RS485</span></a>
        

        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Extension Port</span>
        

        
        <ul>
          
            <li><a href="/en/extensionPort/index">Overview</a></li>
          
            <li><a href="/en/extensionPort/I2CMaster">I²C Breakout-Boards</a></li>
          
            <li><a href="/en/extensionPort/I2CSlave">I²C TX-/TXT Communication</a></li>
          
            <li><a href="/en/extensionPort/gyro">Gyro</a></li>
          
            <li><a href="/en/extensionPort/outputs">Motor Outputs</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Firmware</span>
        

        
        <ul>
          
            <li><a href="/en/firmware/Configuration">Konfiguration</a></li>
          
            <li><a href="/en/firmware/firmware">Firmware & Updates</a></li>
          
            <li><a href="/en/firmware/versions">Versionen</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Advanced</span>
        

        
        <ul>
          
            <li><a href="/en/advanced/PlatformIO">PlatformIO & VSCode</a></li>
          
            <li><a href="/en/advanced/debugging">Debugging</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <div class="archive">
    
      <h1 id="page-title" class="page__title">I²C TX-/TXT-Communication</h1>
    
    <p>This mode can be used to connect the Swarm to a fischertechnik TX or TXT controller. The fischertechnik controller is not integrated into the Swarm as a Swarm member; however, your normal RoboPro program can exchange data with the Swarm via the I²C interface.</p>

<p>With this coupling, the ftSwarm is an I²C bus slave device and provides up to eight 8-bit registers for data exchange. The TXT controller can actively read the registers or write values to them. All registers can be used as read and write registers.</p>

<p>You determine the meaning/function of a register yourself. For the firmware, the registers are just a block of 8 bytes.</p>

<p>Each ftSwarm, ftSwarmRS or ftSwarmXL controller in the Swarm can take over communication with the TXT controller.</p>

<p class="notice--info">For this operating mode, set <strong>Mode</strong> to <strong>I2C Master</strong> in the <strong>Extension Menu</strong> of the firmware.</p>

<h3 id="connecting-the-hardware">Connecting the hardware</h3>

<p>Connecting the two I²C interfaces on the TXT controller is very simple and can be done using jumper cables, for example:</p>

<div class="centershock"><img src="/assets/img/TXT-ftSwarm.svg" width="33%" /></div>

<p class="notice--info">The pins of the extension port are not protected against reverse polarity. Switching errors can damage both your ftSwarm controller and the TXT controller.</p>

<p class="notice--info">Please note that the TX controller uses 5V logic levels and requires a level converter such as the ftExtender.</p>

<h3 id="send-data-from-the-txtxt-controller-to-the-swarm">Send data from the TX/TXT controller to the Swarm</h3>

<p>If the TXT is to transfer data to the Swarm, this is done via the RoboPro command <strong>I2C Write</strong>:</p>

<div class="centershock"><img src="/assets/img/i2c-write.png" width="400" /></div>

<p>In this example, the TXT controller writes the value 42 to register 3. The I²C address used must be that of the ftSwarm controller. 0x66 is the default address of the controller.</p>

<p>The value is transferred to the Kelda in the Swarm and can be read out there using the <code class="language-plaintext highlighter-rouge">getRegister</code> function:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FtSwarmI2C</span> <span class="o">*</span><span class="n">i2c</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FtSwarmI2C</span><span class="p">(</span> <span class="s">"I2C Alias"</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span> <span class="s">"Read I2C-Register #3: %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i2c</span><span class="o">-&gt;</span><span class="n">getRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div></div>

<p>Please note that the register changes are “only” transmitted by the TXT in the swarm every 25 ms. If the TXT writes different values to a register within 25 ms, the Kelda can only process the last value.</p>

<p class="notice--info">The I²C address of the ftSwarm controller is set in the <strong>Extension Port Menu</strong> with the <strong>I2C Slave Address</strong> option. The number of available registers is set in the same menu using the <strong>I2C Registers</strong> option.</p>

<h3 id="send-data-from-the-swarm-to-the-txtxt-controller">Send data from the Swarm to the TX/TXT controller</h3>

<p>Data is sent from the Swarm to the TXT controller using the <code class="language-plaintext highlighter-rouge">setRegister</code> function. In this example, the value 42 is set in register 0.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FtSwarmI2C</span> <span class="o">*</span><span class="n">i2c</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FtSwarmI2C</span><span class="p">(</span> <span class="s">"I2C Alias"</span><span class="p">);</span>
<span class="n">i2c</span><span class="o">-&gt;</span><span class="n">setRegister</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
</code></pre></div></div>

<p>The TXT controller reads the register using the RoboPro command “I2C Read”:</p>

<div class="centershock"><img src="/assets/img/i2c-read.png" width="400" /></div>

<p>RoboPro must always read out all available registers. The example only works if the number of I²C registers has been set to 1 in the firmware. If, for example, 4 registers are to be used, all 4 registers must always be read in Robo-Pro:</p>

<div class="centershock"><img src="/assets/img/i2c-multiple-read.png" width="250" /></div>

<p>The first three read commands require the “leave open” option; this option is not set for the fourth command.</p>

<h3 id="interrupt-mode">Interrupt mode</h3>

<p>For the TXT, it is often only interesting to read out the I²C registers if they have also been changed. For this purpose, a pin of a motor output can be connected to an input of the TXT. If the Swarm writes to the register, the motor output is activated. The TXT sees the edge and then reads the registers. When the registers are read, the motor output is deactivated again.</p>

<div class="centershock"><img src="/assets/img/i2c-multiple-read-interrupt.png" width="250" /></div>

<p>In this code example, the registers are only read out if there is an edge change at input I1.</p>

<p>The motor output must be on the same swarm member on which the I²C connection was switched. Only one of the two connections at the motor output is connected:</p>

<div class="centershock"><img src="/assets/img/TXT-ftSwarm-Int.svg" width="33%" /></div>

<p>In the firmware of the ftSwarm controller, the <strong>Interrupt Line</strong> option is set to the corresponding motor output.</p>

<p>The two menu items <strong>Interrupt Low Value</strong> and <strong>Interrupt High Value</strong> can be used to set the speed values for the motor output. As a rule, these are -255 for <strong>Low</strong> and 255 for <strong>High</strong>. Depending on which connection was used at the motor output, you may have to swap the two values.</p>



<div class="entries-list">
  
</div>

  </div>
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/elektrofuzzis" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/elektrofuzzies" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="mailto:ftpi@gmx.de" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 The ftSwarm Project. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
